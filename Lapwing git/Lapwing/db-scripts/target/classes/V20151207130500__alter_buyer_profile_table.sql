/* no longer required as we are using username to find profiles now */
ALTER TABLE BUYER_PROFILES DROP CONSTRAINT UQ_BUYER_PROFILES_REFERENCE;
ALTER TABLE BUYER_PROFILES DROP COLUMN REFERENCE;

/* add new profile attributes */
ALTER TABLE BUYER_PROFILES ADD COLUMN CONTACT_ID INTEGER;
ALTER TABLE BUYER_PROFILES ADD COLUMN DELIVERY_ADDRESS_ID INTEGER;
ALTER TABLE BUYER_PROFILES ADD COLUMN BANK_ACCOUNT_ID INTEGER;

/* build links for attributes */
ALTER TABLE BUYER_PROFILES ADD CONSTRAINT FK_BUYER_PROFILES_CONTACT FOREIGN KEY (CONTACT_ID) REFERENCES CONTACTS (ID);
ALTER TABLE BUYER_PROFILES ADD CONSTRAINT FK_BUYER_PROFILES_ADDRESS FOREIGN KEY (DELIVERY_ADDRESS_ID) REFERENCES addresses (ID);
ALTER TABLE BUYER_PROFILES ADD CONSTRAINT FK_BUYER_PROFILES_BANK_ACCOUNT FOREIGN KEY (BANK_ACCOUNT_ID) REFERENCES bank_accounts (ID);

/* column tweaks */
ALTER TABLE CONTACTS DROP COLUMN password;
ALTER TABLE CONTACTS ALTER COLUMN phone_number TYPE VARCHAR(11);
ALTER TABLE BANK_ACCOUNTS ALTER COLUMN account_number TYPE VARCHAR(8);